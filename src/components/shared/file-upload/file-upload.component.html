<div>
  <div class="flex flex-col md:flex-row justify-between items-start mb-6">
    <div>
        <h2 class="text-xl font-semibold text-brand-text-primary">{{ title() }}</h2>
        <p class="text-brand-text-secondary mt-1">{{ description() }}</p>
    </div>
    <button (click)="clearJobs()" class="bg-red-50 hover:bg-red-100 text-brand-danger font-semibold py-2 px-4 rounded-lg flex items-center gap-2 border border-red-200 mt-4 md:mt-0">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z" clip-rule="evenodd" /></svg>
      <span>Clear All Jobs</span>
    </button>
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Upload Area -->
    <div>
      <div class="bg-slate-50 border-2 border-dashed border-brand-border rounded-lg p-8 text-center cursor-pointer hover:border-brand-primary transition-colors duration-300" (click)="fileInput.click()">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" /></svg>
        <h3 class="text-lg font-semibold text-brand-text-primary mt-4">Click to browse or drop file here</h3>
        <p class="text-sm text-brand-text-secondary mt-1">Supports .xlsx files</p>
        <input type="file" #fileInput (change)="onFileSelected($event)" accept=".xlsx" class="hidden">
      </div>
      @if (selectedFile(); as file) {
        <div class="mt-4 bg-slate-100 p-3 rounded-lg flex justify-between items-center border border-brand-border">
          <span class="text-brand-text-primary text-sm">Selected: <span class="font-semibold">{{ file.name }}</span></span>
          <button (click)="uploadFile()" [disabled]="uploadStatus() === 'uploading'" class="bg-brand-primary hover:bg-brand-accent text-white font-bold py-2 px-4 rounded-lg disabled:bg-slate-400 disabled:cursor-not-allowed">
             {{ uploadStatus() === 'uploading' ? 'Uploading...' : 'Upload & Add Jobs' }}
          </button>
        </div>
      }
    </div>

    <!-- Status & Processed Data -->
    <div>
      <h3 class="text-lg font-semibold mb-4 text-brand-text-primary">Processing Status</h3>
      <div class="bg-slate-50 p-4 rounded-lg text-brand-text-secondary min-h-[80px] flex items-center border border-brand-border text-sm">
        @if (uploadStatus() === 'idle') {
          <span>Ready for file upload. Processed data will appear below.</span>
        }
        @if (uploadStatus() === 'uploading') {
          <div class="text-brand-text-primary flex items-center gap-2">
            <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <span>{{ uploadMessage() }}</span>
          </div>
        }
        @if (uploadStatus() === 'success') {
          <div class="text-green-700 flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg> {{ uploadMessage() }}</div>
        }
        @if (uploadStatus() === 'error') {
          <div class="text-red-700 flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" /></svg> {{ uploadMessage() }}</div>
        }
      </div>

      <div class="mt-6">
        <h3 class="text-lg font-semibold mb-4 text-brand-text-primary">Current Payroll Summary</h3>
        <div class="space-y-3 max-h-96 overflow-y-auto pr-2">
          @for (tech of processedTechnicians(); track tech.id) {
            @if(tech.totalJobs > 0 || tech.adjustments.length > 0) {
              <div class="bg-slate-50 p-4 rounded-lg hover:shadow-md transition-shadow border border-brand-border">
                  <div class="flex justify-between items-center">
                    <p class="font-bold text-lg text-brand-text-primary">{{ tech.name }} <span class="text-sm text-brand-text-secondary">#{{ tech.techId }}</span></p>
                    <span class="text-green-600 font-semibold">{{ tech.totalEarnings | currency }}</span>
                  </div>
                  <div class="text-sm text-brand-text-secondary grid grid-cols-2 md:grid-cols-4 gap-x-4 mt-2">
                     <span>Jobs: {{ tech.totalJobs }}</span>
                     <span>Revenue: {{ tech.totalRevenue | currency }}</span>
                     <span>Avg/Job: {{ tech.avgPerJob | currency }}</span>
                     <span>Co. Revenue: {{ tech.companyRevenue | currency }}</span>
                  </div>
              </div>
            }
          } @empty {
            <div class="text-center text-brand-text-secondary py-8">
              <p>No jobs have been uploaded for the current period.</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>